<!-- Button trigger modal -->
<button type="button" hidden id="activeModalSchedaAnagrafica" class="btn btn-primary " data-bs-toggle="modal"
    data-bs-target="#modalSchedaAnagrafica"></button>

<div class="modal fade bd-example-modal-xl" id="modalSchedaAnagrafica" tabindex="-1" role="dialog"
    aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-insert-voto-estero">
        <div class="modal-content">
            <div class="modal-header mb-2">
                <h4 class="modal-title">Modifica Scheda</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                    aria-label="Chiudi finestra modale"></button>
            </div>
            <div class="modal-body modal-body-update">
                <div class="container">
                    <div class="row margin-row-top">
                        <div class="col select-wrapper">
                            <label for="qualifiche"
                                [ngClass]="{'color-invalid': validIdQualifica === false}">Qualifica</label>
                            <select type="text" [(ngModel)]="idQualifica" (change)="checkTitolo()" id="qualifiche"
                                class="data_input" [ngClass]="{'input-invalid': validIdQualifica === false}">
                                <option [value]=""></option>
                                <option *ngFor="let qualifica of qualifiche" [value]="qualifica.idQualifica">
                                    {{ qualifica.qualifica }}
                                </option>
                            </select>
                        </div>
                        <div class="col select-wrapper" *ngIf="idQualifica === '6'">
                            <label for="descQualifica" [ngClass]="{'active': !!descQualifica}"
                                [ngClass]="{'color-invalid': validDescQualifica === false}">
                                Nome qualifica*
                            </label>
                            <input type="text" [(ngModel)]="descQualifica" class="data_input" id="descQualifica"
                                [ngClass]="{'input-invalid': validDescQualifica === false}" />
                        </div>
                        <div class="col select-wrapper">
                            <label for="titoloSS" [ngClass]="{'color-invalid': validTitolo === false}">Titolo*</label>
                            <select type="text" [(ngModel)]="idTitolo" (change)="checkTitolo()" id="titoloSS"
                                class="data_input" [ngClass]="{'input-invalid': validTitolo === false}">
                                <option [value]=""></option>
                                <option *ngFor="let titolo of titoliAnagrafiche" [value]="titolo.idTitoloAnagrafiche">
                                    {{ titolo.descrizione }}
                                </option>
                            </select>
                        </div>
                        <div class="col select-wrapper" *ngIf="idQualifica != '6'"></div>
                    </div>
                    <div class="row margin-row-top">
                        <div class="col ">
                            <p class="fw-semibold" [ngClass]="{'color-invalid': validSesso === false}">Sesso*</p>
                            <div class="form-check">
                                <input name="radio3" [checked]="sesso === 'M'" [value]="'M'" type="radio"
                                    class="with-gap" id="radio3" (change)="sessoCheckboxChange('M')">
                                <label for="radio3">Maschio</label>
                                <input name="radio4" [checked]="sesso === 'F'" [value]="'F'" type="radio"
                                    class="with-gap" id="radio4" (change)="sessoCheckboxChange('F')">
                                <label for="radio4">Femmina</label>
                            </div>
                        </div>
                        <div class="col select-wrapper">
                            <label for="cognomeRapLegale" [ngClass]="{'active': !!cognome}"
                                [ngClass]="{'color-invalid': validCognome === false}">
                                Cognome
                            </label>
                            <input type="text" [disabled]="true" [(ngModel)]="cognome" (blur)="checkCognome()"
                                class="data_input" id="cognomeRapLegale"
                                [ngClass]="{'input-invalid': validCognome === false}" />
                        </div>
                        <div class="col select-wrapper">
                            <label for="nomeRapLegale" [ngClass]="{'active': !!nome}"
                                [ngClass]="{'color-invalid': validNome === false}">
                                Nome
                            </label>
                            <input type="text" [disabled]="true" [(ngModel)]="nome" (blur)="checkNome()"
                                class="data_input" id="nomeRapLegale"
                                [ngClass]="{'input-invalid': validNome === false}" />
                        </div>
                    </div>
                    <div class="row margin-row-top">
                        <div class="col select-wrapper">
                            <label for="dataRapLegale" class="active"
                                [ngClass]="{'color-invalid': validDataNascita === false}">
                                Data di nascita*
                            </label>
                            <input type="date" [(ngModel)]="dataNascita" (blur)="checkDataNascita()" class="data_input"
                                id="dataNascita" name="dataNascita" data-focus-mouse="false" id="dataNascita"
                                [ngClass]="{'input-invalid': validDataNascita === false}" />
                        </div>
                        <div class="col select-wrapper">
                            <label for="isEsteroNascita">Stato di nascita</label>
                            <select type="text" [(ngModel)]="isEsteroNascita" id="isEsteroNascita" [value]=""
                                class="data_input">
                                <option [value]="'false'">Italia</option>
                                <option [value]="'true'">Estero</option>
                            </select>
                        </div>
                        <div class="col select-wrapper" *ngIf="isEsteroNascita === 'true'">
                            <label for="nomeStatoDiNasc" [ngClass]="{'active': !!statoNascita}"
                                [ngClass]="{'input-invalid': validStatoNascita === false}">
                                Nome stato di nascita*
                            </label>
                            <input type="text" [(ngModel)]="statoNascita" (blur)="checkStatoNascita()"
                                class="data_input" id="nomeStatoDiNasc"
                                [ngClass]="{'input-invalid': validStatoNascita === false}" />
                        </div>
                        <div class="col select-wrapper" *ngIf="isEsteroNascita === 'false'">
                            <label for="comune" class="active"
                                [ngClass]="{'color-invalid': validComuneSceltoNascita === false}">Luogo di
                                nascita*</label>
                            <input aria-expanded="false" [(ngModel)]="comuneSceltoNascita"
                                (blur)="checkComuneSceltoNascita()" (input)="loadComuneNascita($event)"
                                class="data_input" autocomplete="off" id="comune" type="text"
                                [placeholder]="'Selezionare un comune'"
                                [ngClass]="{'input-invalid': validComuneSceltoNascita === false}">

                            <ul *ngIf="showListComuneNascita"
                                class="autocomplete__menu autocomplete__menu--inline autocomplete__menu--inline select-liste-ul"
                                id="comuneNascitaAutocompleteListbox" role="listbox">
                                <li aria-selected="false" class="autocomplete__option" role="option" tabindex="-1"
                                    aria-posinset="1" aria-setsize="32" *ngFor="let comune of comuniNascita"
                                    (click)="selectComuneNascita(comune.idCodComune, comune.nomeComune + ' (' + comune.regioneProvince.siglaProvincia + ')')">
                                    {{comune.nomeComune + " (" + comune.regioneProvince.siglaProvincia + ")"}}
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="row margin-row-top">
                        <div class="col select-wrapper" *ngIf="isEsteroNascita === 'true'">
                            <label for="comuneNascitaEstero" [ngClass]="{'active': !!comuneNascitaEstero}"
                                [ngClass]="{'color-invalid': validComuneNascitaEstero === false}">
                                Luogo di nascita*
                            </label>
                            <input type="text" [(ngModel)]="comuneNascitaEstero" (blur)="checkComuneNascitaEstero()"
                                class="data_input" id="comuneNascitaEstero"
                                [ngClass]="{'input-invalid': validComuneNascitaEstero === false}" />
                        </div>
                        <div class="col select-wrapper">
                            <label for="codFiscaleRapLegale" [ngClass]="{'active': !!codiceFiscaleSS}"
                                [ngClass]="{'color-invalid': validCodiceFiscale === false}">
                                Codice fiscale*
                            </label>
                            <input type="text" [disabled]="true" [(ngModel)]="codiceFiscaleSS"
                                (blur)="checkCodiceFiscale()" class="data_input" id="codFiscaleRapLegale"
                                [ngClass]="{'input-invalid': validCodiceFiscale === false}" />
                        </div>
                        <div class="col select-wrapper">
                            <label for="cittaRapSoc" [ngClass]="{'active': !!cittadinanza}"
                                [ngClass]="{'color-invalid': validCittadinanza === false}">
                                Cittadinanza*
                            </label>
                            <input type="text" [(ngModel)]="cittadinanza" (blur)="checkCittadinanza()"
                                class="data_input" id="cittaRapSoc"
                                [ngClass]="{'input-invalid': validCittadinanza === false}" />
                        </div>
                        <div class="col select-wrapper" *ngIf="isEsteroNascita === 'false'">
                            <label for="pecRapLegale" [ngClass]="{'active': !!indirizzoPec}"
                                [ngClass]="{'color-invalid': validPec === false}">
                                Indirizzo PEC*
                            </label>
                            <input type="text" [(ngModel)]="indirizzoPec" (blur)="checkPec()" class="data_input"
                                id="indirizzoPec" [ngClass]="{'input-invalid': validPec === false}" />
                        </div>
                    </div>
                    <div class="row margin-row-top">
                        <div class="col select-wrapper" *ngIf="isEsteroNascita === 'true'">
                            <label for="pecRapLegale" [ngClass]="{'active': !!indirizzoPec}"
                                [ngClass]="{'color-invalid': validPec === false}">
                                Indirizzo PEC*
                            </label>
                            <input type="text" [(ngModel)]="indirizzoPec" (blur)="checkPec()" class="data_input"
                                id="indirizzoPec" [ngClass]="{'input-invalid': validPec === false}" />
                        </div>
                        <div class="col select-wrapper">
                            <label for="mailRapLegale" [ngClass]="{'active': !!indirizzoEmail}"
                                [ngClass]="{'color-invalid': validMail === false}">
                                Altro Indirizzo Email*
                            </label>
                            <input type="text" [(ngModel)]="indirizzoEmail" (blur)="checkMail()" class="data_input"
                                id="cellulareRapLegale" [ngClass]="{'input-invalid': validMail === false}" />
                        </div>
                        <div class="col select-wrapper"></div>
                        <div class="col select-wrapper" *ngIf="isEsteroNascita === 'false'"></div>
                    </div>
                    <div class="row margin-row-top">
                        <p class="fw-semibold h2">Residenza:</p>
                        <hr />
                    </div>
                    <div class="row margin-row-top">
                        <div class="col select-wrapper">
                            <label for="isEsteroResidenza">Stato di Residenza*</label>
                            <select type="text" [(ngModel)]="isEsteroResidenza" id="isEsteroResidenza"
                                class="data_input">
                                <option [value]="'false'">Italia</option>
                                <option [value]="'true'">Estero</option>
                            </select>
                        </div>
                        <div class="col select-wrapper" *ngIf="isEsteroResidenza == 'true'">
                            <label for="statoDiResidenza" [ngClass]="{'active': !!statoResidenza}"
                                [ngClass]="{'color-invalid': validStatoResidenza === false}">
                                Nome Stato di residenza*
                            </label>
                            <input type="text" [(ngModel)]="statoResidenza" (blur)="checkStatoResidenza()"
                                class="data_input" id="statoDiResidenza"
                                [ngClass]="{'input-invalid': validStatoResidenza === false}" />
                        </div>
                        <div class="col select-wrapper" *ngIf="isEsteroResidenza == 'true'">
                            <label for="comuneResidenzaEstero" [ngClass]="{'active': !!comuneResidenzaEstero}"
                                [ngClass]="{'color-invalid': validComuneResidenzaEstero === false}">
                                Luogo di residenza*
                            </label>
                            <input type="text" [(ngModel)]="comuneResidenzaEstero" (blur)="checkComuneResidenzaEstero()"
                                class="data_input" id="comuneResidenzaEstero"
                                [ngClass]="{'input-invalid': validComuneResidenzaEstero === false}" />
                        </div>
                        <div class="col select-wrapper" *ngIf="isEsteroResidenza == 'false'">
                            <label for="comune" class="active"
                                [ngClass]="{'color-invalid': validComuneSceltoResidenza === false}">Comune*</label>
                            <input aria-expanded="false" [(ngModel)]="comuneSceltoResidenza"
                                (blur)="checkComuneSceltoResidenza()" (input)="loadComuneResidenza($event)"
                                class="data_input" autocomplete="off" id="comune" type="text"
                                [placeholder]="'Digitare le iniziali di un Comune'"
                                [ngClass]="{'input-invalid': validComuneSceltoResidenza === false}">

                            <ul *ngIf="showListComuneResidenza"
                                class="autocomplete__menu autocomplete__menu--inline autocomplete__menu--inline select-liste-ul"
                                id="comuneResidenzaAutocompleteListbox" role="listbox">
                                <li aria-selected="false" class="autocomplete__option" role="option" tabindex="-1"
                                    aria-posinset="1" aria-setsize="32" *ngFor="let comune of comuniResidenza"
                                    (click)="selectComuneResidenza(comune.idCodComune, comune.nomeComune + ' (' + comune.regioneProvince.siglaProvincia + ')')">
                                    {{comune.nomeComune + " (" + comune.regioneProvince.siglaProvincia + ")"}}
                                </li>
                            </ul>
                        </div>
                        <div class="col select-wrapper" *ngIf="isEsteroResidenza == 'false'">
                            <label for="indirizzoResidenza" [ngClass]="{'active': !!indirizzoResidenza}"
                                [ngClass]="{'color-invalid': validIndirizzoResidenza === false}">
                                Via/Piazza*
                            </label>
                            <input type="text" [(ngModel)]="indirizzoResidenza" class="data_input"
                                id="indirizzoResidenza" (blur)="checkIndirizzoResidenza()"
                                [ngClass]="{'input-invalid': validIndirizzoResidenza === false}" />
                        </div>
                    </div>
                    <div class="row margin-row-top">
                        <div class="col select-wrapper" *ngIf="isEsteroResidenza == 'true'">
                            <label for="indirizzoResidenza" [ngClass]="{'active': !!indirizzoResidenza}"
                                [ngClass]="{'color-invalid': validIndirizzoResidenza === false}">
                                Via/Piazza*
                            </label>
                            <input type="text" [(ngModel)]="indirizzoResidenza" class="data_input"
                                id="indirizzoResidenza" (blur)="checkIndirizzoResidenza()"
                                [ngClass]="{'input-invalid': validIndirizzoResidenza === false}" />
                        </div>
                        <div class="col select-wrapper">
                            <label for="numeroCivicoResidenza" [ngClass]="{'active': !!numeroCivicoResidenza}"
                                [ngClass]="{'color-invalid': validNumeroCivicoResidenza === false}">
                                Numero civico*
                            </label>
                            <input type="text" [(ngModel)]="numeroCivicoResidenza" class="data_input"
                                id="numeroCivicoResidenza" (blur)="checkNumeroCivicoResidenza()"
                                [ngClass]="{'input-invalid': validNumeroCivicoResidenza === false}" />
                        </div>
                        <div class="col select-wrapper">
                            <label for="capResidenza" [ngClass]="{'active': !!capResidenza}"
                                [ngClass]="{'color-invalid': validCapResidenza === false}">
                                Cap*
                            </label>
                            <input type="text" [(ngModel)]="capResidenza" class="data_input" id="capResidenza"
                                (blur)="checkCapResidenza()"
                                [ngClass]="{'input-invalid': validCapResidenza === false}" />
                        </div>
                        <div class="col select-wrapper" *ngIf="isEsteroResidenza == 'false'"></div>
                    </div>
                    <div class="row margin-row-top">
                        <div class="form-check">
                            <input id="checkboxDomicilio" type="checkbox" [(ngModel)]="domicilio">
                            <label for="checkboxDomicilio" class="fw-semibold">Domicilio (se diverso dalla
                                residenza):</label>
                        </div>
                    </div>
                    <hr />
                    <div *ngIf="domicilio">
                        <div class="row margin-row-top">
                            <div class="col select-wrapper">
                                <label for="isEsteroDomicilio">Stato di domicilio</label>
                                <select type="text" [(ngModel)]="isEsteroDomicilio"
                                    id="isEsteroDomicilio" class="data_input">
                                    <option [value]="'false'">Italia</option>
                                    <option [value]="'true'">Estero</option>
                                </select>
                            </div>
                
                            <div class="col select-wrapper" *ngIf="isEsteroDomicilio == 'false'">
                                <label for="comuneDomicilio" class="active">Comune</label>
                                <input aria-expanded="false" [(ngModel)]="comuneSceltoDomicilio"
                                    (input)="loadComuneDomicilio($event)" class="data_input" autocomplete="off" id="comuneDomicilio"
                                    type="text" [placeholder]="'Digitare le iniziali di un Comune'">
                
                                <ul *ngIf="showListComuneDomicilio"
                                    class="autocomplete__menu autocomplete__menu--inline autocomplete__menu--inline select-liste-ul"
                                    id="comuneDomicilioAutocompleteListbox" role="listbox">
                                    <li aria-selected="false" class="autocomplete__option" role="option" tabindex="-1" aria-posinset="1"
                                        aria-setsize="32" *ngFor="let comune of comuniDomicilio"
                                        (click)="selectComuneDomicilio(comune.idCodComune, comune.nomeComune + ' (' + comune.regioneProvince.siglaProvincia + ')')">
                                        {{comune.nomeComune + " (" + comune.regioneProvince.siglaProvincia + ")"}}
                                    </li>
                                </ul>
                            </div>
                            <div class="col select-wrapper" *ngIf="isEsteroDomicilio == 'true'">
                                <label for="comuneDomicilioEstero" [ngClass]="{'active': !!comuneDomicilioEstero}">
                                    Luogo di domicilio
                                </label>
                                <input type="text" [(ngModel)]="comuneDomicilioEstero"
                                    class="data_input" id="comuneDomicilioEstero" />
                            </div>
                            <div class="col select-wrapper" *ngIf="isEsteroDomicilio == 'true'">
                                <label for="statoDomicilio" [ngClass]="{'active': !!statoDomicilio}">
                                    Nome Stato di domicilio
                                </label>
                                <input type="text" [(ngModel)]="statoDomicilio" class="data_input"
                                    id="statoDomicilio" />
                            </div>
                            <div *ngIf="isEsteroDomicilio === 'false'" class="col select-wrapper">
                                <label for="indirizzoDomicilio" [ngClass]="{'active': !!indirizzoDomicilio}" [ngClass]="{'color-invalid': validIndirizzoDomicilio === false}">
                                    Via/Piazza*
                                </label>
                                <input type="text" [(ngModel)]="indirizzoDomicilio" class="data_input"
                                    id="indirizzoDomicilio" [ngClass]="{'input-invalid': validIndirizzoDomicilio === false}"/>
                            </div>
                        </div>
                        
                        <div class="row margin-row-top">
                            <div *ngIf="isEsteroDomicilio === 'true'" class="col select-wrapper">
                                <label for="indirizzoDomicilio" [ngClass]="{'active': !!indirizzoDomicilio}" [ngClass]="{'color-invalid': validIndirizzoDomicilio === false}">
                                    Via/Piazza*
                                </label>
                                <input type="text" [(ngModel)]="indirizzoDomicilio" class="data_input"
                                    id="indirizzoDomicilio" [ngClass]="{'input-invalid': validIndirizzoDomicilio === false}"/>
                            </div>
                            <div class="col select-wrapper">
                                <label for="numeroDomicilio" [ngClass]="{'active': !!numeroCivicoDomicilio}" [ngClass]="{'color-invalid': validNumeroDomicilio === false}">
                                    Numero Civico*
                                </label>
                                <input type="text" [(ngModel)]="numeroCivicoDomicilio"
                                    class="data_input" id="numeroDomicilio" [ngClass]="{'input-invalid': validNumeroDomicilio === false}"/>
                            </div>
                            <div class="col select-wrapper">
                                <label for="capDomicilio" [ngClass]="{'active': !!capDomicilio}" [ngClass]="{'color-invalid': validCapDomicilio === false}">
                                    Cap*
                                </label>
                                <input type="text" [(ngModel)]="capDomicilio" class="data_input"
                                    id="capDomicilio" [ngClass]="{'input-invalid': validCapDomicilio === false}"/>
                            </div>
                            <div class="col select-wrapper" *ngIf="isEsteroDomicilio == 'false'"></div>
                        </div>
                    </div>

                    <div class="row margin-row-top">
                        <div class="col select-wrapper">
                            <label for="allegatoDocumento" [ngClass]="{'active': true}">
                                Allega copia documento*
                            </label>
                            <input type="file" (change)="onFileDocumento($event)" data-bs-input class="data_input"
                                id="allegatoDocumento" accept=".pdf" />
                        </div>
                        <div class="col select-wrapper"></div>
                        <div class="col select-wrapper"></div>
                    </div>
                </div>

                <div class="modal-footer">
                    <div class="modal-footer">
                        <button class="btn float-end btn-menu-page-body btn-outline-primary-min" data-bs-dismiss="modal"
                            type="button">Annulla
                        </button>
                        
                        <button type="button" (click)="convalidazione()" *ngIf="isConvalidato == false"
                            class="btn btn-primary-min float-end btn-menu-page-body">Convalida 
                        </button>
                        <button id="closeModal" hidden type="button" data-bs-dismiss="modal">Close modal</button>
                        <button type="button" (click)="saveScheda()"
                            class="btn btn-secondary-min float-end btn-menu-page-body">Salva
                        </button>
                    </div>
                </div>
            </div>